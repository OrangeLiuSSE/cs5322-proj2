# Database Table Design
## 1. User Table Design and Security
### 1.1 Table Design
``` sql
CREATE TABLE Users (
    user_id      NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    username     VARCHAR2(50) NOT NULL UNIQUE,
    password     VARCHAR2(255) NOT NULL,
    role         VARCHAR2(20) CHECK (role IN ('student', 'teacher', 'guest', 'manager', 'admin')),
    email        VARCHAR2(100) NOT NULL UNIQUE,
    created_at   DATE DEFAULT SYSDATE,
    last_login   DATE
);
```

### 1.2 Secutiry Design
- Guest\student\teacher can only (Select and Update) the information themselves
- Admin can (Select Update Drop Insert) all Information

## 2. Book Table Design and Security
### 2.1Table Design
In this table, the category will have "public", "student", "teacher", "admin"
And the classification(compartment) will have "book", "testpaper"
```sql
CREATE TABLE Books (
    book_id           NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    user_id           NUMBER,
    title             VARCHAR2(200) NOT NULL,
    author            VARCHAR2(100),
    publisher         VARCHAR2(100),
    publication_year  NUMBER CHECK (publication_year BETWEEN 1000 AND 9999),
    isbn              VARCHAR2(20) UNIQUE,
    category          VARCHAR2(50),
    classification    VARCHAR2(50)
);
```
### 2.2 Security Design
- Guest can only **select** the "public" and "book"
- Student can **select** the "public" "student" 's "book"
- Teacher can **select** the "public" "student" "teacher"'s "book" and "testpaper" also can **insert / delete / update** the "testpaper" which user_id is themselves 
- Admin can **select insert delete update** all kinds of books

## 3. Circulation
- Circulation（图书状态流转表）
```sql
CREATE TABLE Book_Circulation_Status (
    status_id      NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    book_id        NUMBER NOT NULL,  -- 参考 Books 表中的 book_id
    circulation_status VARCHAR2(50) CHECK (circulation_status IN ('available', 'borrowed', 'reserved', 'unavailable')) DEFAULT 'available',  -- 图书流通状态
    due_date       DATE,  -- 归还日期（如有）
    reserved_by    NUMBER,  -- 预订者的用户ID（如有）
);
```

### 3.2 Security
- Guest（访客）：只能查看 available 状态的图书记录。
- Student（学生）：可以查看 available 和 borrowed 和 reserved 状态的图书记录，但无法查看 unavailable 状态的图书记录。
- Teacher（教师）：可以查看 available、borrowed 和 reserved 状态的图书记录。
- Admin（管理员）：可以访问所有记录，包括 available、borrowed 和 reserved 状态的图书记录。

- Reservations（预定表）
```sql
CREATE TABLE Reservations (
    reservation_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    user_id        NUMBER NOT NULL,
    book_id        NUMBER NOT NULL,
    reservation_date DATE DEFAULT SYSDATE,
    status         VARCHAR2(20) CHECK (status IN ('pending', 'fulfilled', 'cancelled')) DEFAULT 'pending',
);
```

- Borrow_Records
```sql
CREATE TABLE Borrow_Records (
    record_id    NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    user_id      NUMBER NOT NULL,
    book_id      NUMBER NOT NULL,
    borrow_date  DATE DEFAULT SYSDATE,
    return_date  DATE
);
```

- Reviews
```sql
CREATE TABLE Reviews (
    review_id   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    user_id     NUMBER NOT NULL,
    book_id     NUMBER NOT NULL,
    rating      NUMBER CHECK (rating BETWEEN 1 AND 5),  -- 评分范围为1到5
    comment     VARCHAR2(1000),  -- 评论内容，最大1000字符
    created_at  DATE DEFAULT SYSDATE  -- 默认评论日期为当前系统时间
);
```

two kinds of reviews: everybody can see / nobody can see
only admin can delete the comment
user could modify his/her own comment

- Notification
```sql
CREATE TABLE Notifications (
    notification_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    content         VARCHAR2(1000) NOT NULL,  -- 通知内容，最大1000字符
    classification  NUMBER NOT NULL,
    created_at      DATE DEFAULT SYSDATE       -- 发布日期，默认为当前系统时间
);
```

- Book_Inventory(库存)
```sql
CREATE TABLE Book_Inventory (
    inventory_id  NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    book_id       NUMBER NOT NULL,
    total_quantity NUMBER DEFAULT 0,  -- 总数量
    available_quantity NUMBER DEFAULT 0,  -- 可借数量
    damaged_quantity NUMBER DEFAULT 0,  -- 损坏数量
);
```

### Level
WIKI、CONFIDENTIAL、SECRET、TOP_SECRET
### Compartment
BOOK、TESTPAPER、SLIDES、ManagementDoc
### GROUP
SoC、MEDICAL、ISS、BIZ、ENGINEER
### SubGroup
SoC-Gen SoC-AI SoC-CS SoC-IS SoC-InfoSec

### Book

#### Book 中的标签
WIKI::       #有点类似于百科（人人都可以修改）
CONFIDENTIAL:BOOK:
SECRET:SLIDES:SoC-Gen
SECRET:TESTPAPER:MEDICAL
TOP_SECRET:ManagementDoc:

#### Bulid Level and Compartment and Group
```sql
BEGIN
    SA_SYSDBA.CREATE_POLICY (
        policy_name   => 'doc_ols',
        column_name   => 'doc_ols_col',
        default_options   => NULL
   );

    # Level Define
    SA_COMPONENTS.CREATE_LEVEL (
        policy_name    => 'doc_ols',
        level_num      => 10,
        short_name     => 'WK',
        long_name      => 'WIKI'
    );
    SA_COMPONENTS.CREATE_LEVEL (
        policy_name    => 'doc_ols',
        level_num      => 20,
        short_name     => 'CONF',
        long_name      => 'CONFIDENTIAL'
    );
    SA_COMPONENTS.CREATE_LEVEL (
        policy_name    => 'doc_ols',
        level_num      => 30,
        short_name     => 'S',
        long_name      => 'SECRET'
    );
    SA_COMPONENTS.CREATE_LEVEL (
        policy_name    => 'doc_ols',
        level_num      => 40,
        short_name     => 'TS',
        long_name      => 'TOP_SECRET'
    );
 # Compartment Define
    SA_COMPONENTS.CREATE_COMPARTMENT (
        policy_name    => 'doc_ols',
        comp_num       => 15,
        short_name     => 'BK',
        long_name      => 'BOOK',
    );

    SA_COMPONENTS.CREATE_COMPARTMENT (
        policy_name    => 'doc_ols',
        comp_num       => 25,
        short_name     => 'TP',
        long_name      => 'TESTPAPER',
    );

    SA_COMPONENTS.CREATE_COMPARTMENT (
        policy_name    => 'doc_ols',
        comp_num       => 35,
        short_name     => 'SL',
        long_name      => 'SLIDES',
    );

    SA_COMPONENTS.CREATE_COMPARTMENT (
        policy_name    => 'doc_ols',
        comp_num       => 45,
        short_name     => 'MD',
        long_name      => 'MANAGEMENTDOC',
    );

 # Group Define
 #SoC
    SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  2000,
        short_name      => 'SOC',
        long_name       => 'COMPUTING'
    );

    SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  2100,
        short_name      => 'SOC_GEN',
        long_name       => 'COMPUTING_GEN'
        parent_name     => 'SOC'
   );
   SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  2200,
        short_name      => 'SOC_CS',
        long_name       => 'COMPUTING_CS'
        parent_name     => 'SOC'
   );
   SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  2300,
        short_name      => 'SOC_IS',
        long_name       => 'COMPUTING_IS'
        parent_name     => 'SOC'
   );
   SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  2400,
        short_name      => 'SOC_AI',
        long_name       => 'COMPUTING_AI'
        parent_name     => 'SOC'
   );

   SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  2500,
        short_name      => 'SOC_ISE',
        long_name       => 'COMPUTING_INFOSEC'
        parent_name     => 'SOC'
   );

   # ENGINEER

    SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  3000,
        short_name      => 'ENG',
        long_name       => 'ENGINEER'
    );

    # ISS

    SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  4000,
        short_name      => 'ISS',
        long_name       => 'SCHOOL_ISS'
    );

    # BUINESS

    SA_COMPONENTS.CREATE_GROUP (
        policy_name     => 'doc_ols',
        group_num       =>  5000,
        short_name      => 'BIZ',
        long_name       => 'SCHOOL_BIZ'
    );

```


#### 用户在Doc中的标签
Guest:
```sql
BEGIN
    SA_USER_ADMIN.SET_LEVELS(
        policy_name => 'doc_ols',
        user_name => 'guest',
        max_level => 'WK',
        min_level => 'WK',
        default_level => NULL,
        row_level => NULL
    )
END;
```
Student:
```sql
BEGIN
    SA_USER_ADMIN.SET_LEVELS(
        policy_name     => 'doc_ols',
        user_name       => 'student',
        max_level       => 'S',
        min_level       => 'WK',
        default_level   => 'CONF',
        row_level       => 'CONF'
    )

    SA_USER_ADMIN.SET_COMPARTMENTS(
        policy_name     => 'doc_ols',
        user_name       => 'student',
        read_comps      => 'BK, SL',
        write_comps     => '',
        def_comps       => NULL,
        row_comps       => NULL
    )

     SA_USER_ADMIN.SET_GROUPS (
        policy_name    => 'doc_ols',
        user_name      => 'student', 
        read_groups    => 'SOC_CS',
        write_groups   => '',
        def_groups     => 'SOC_CS',
        row_groups     => 'SOC_CS'
    );
```

Teacher:
```sql
BEGIN
    SA_USER_ADMIN.SET_LEVELS(
        policy_name     => 'doc_ols',
        user_name       => 'teacher',
        max_level       => 'S',
        min_level       => 'WK',
        default_level   => 'CONF',
        row_level       => 'CONF'
    )

    SA_USER_ADMIN.SET_COMPARTMENTS(
        policy_name     => 'doc_ols',
        user_name       => 'teacher',
        read_comps      => 'TP, BK, SL',
        write_comps     => 'TP, SL',
        def_comps       => NULL,
        row_comps       => NULL
    )

     SA_USER_ADMIN.SET_GROUPS (
        policy_name    => 'doc_ols',
        user_name      => 'teacher', 
        read_groups    => 'SOC',
        write_groups   => '',
        def_groups     => 'SOC',
        row_groups     => 'SOC'
    );
```

Admin:
```sql
BEGIN
    SA_USER_ADMIN.SET_LEVELS(
        policy_name     => 'doc_ols',
        user_name       => 'admin',
        max_level       => 'TS',
        min_level       => 'WK',
        default_level   => 'CONF',
        row_level       => 'CONF'
    )

    SA_USER_ADMIN.SET_COMPARTMENTS(
        policy_name     => 'doc_ols',
        user_name       => 'admin',
        read_comps      => 'BK, SL, MD, TP',
        write_comps     => 'BK, MD',
        def_comps       => 'MD',
        row_comps       => 'MD'
    )

     SA_USER_ADMIN.SET_GROUPS (
        policy_name    => 'doc_ols',
        user_name      => 'admin', 
        read_groups    => 'SC',
        write_groups   => 'SC',
        def_groups     => 'SC',
        row_groups     => 'SC'
    );
```




1. 访客，学生，老师，管理员
设计Level
 Guest： WIKI-UN-10
 Student：CONFIDENTIAL-CONF-20
 Teacher：SECRET-S-30
 Admin：TOP_SECRET-TS-40
设计Compartment
 Guest： Non Compartment
 Student： BOOK
 Teacher： TP、SLIDES、BOOK
